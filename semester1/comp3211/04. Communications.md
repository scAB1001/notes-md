Thursday 09/10/2025

---
#### Module Objectives
 Interprocess communication is at the heart of
all distributed systems
• It is important to examine the ways that processes on different machines can exchange information
• Communication in distributed systems is always based on low level message passing as offered by the underlying network
• Some widely used models for communication:
– Remote Procedure Call (RPC)
– Message Oriented Communication

Large Scale Data Transfer – The Appliance View
• Goal is to provide a “data center in a box”
• Often combined with networking capabilities such as edge gateways and smart routers
• Hard drive in a van:
high latency, high bandwidth!
https://docs.aws.amazon.com/snowball/latest/developer-guide/using-device.html

Latency and Bandwidth
Latency: time until message arrives
• In the same building/datacenter: 1 ms
• One continent to another: 100 ms
• Hard drives in a van: 1 day

Bandwidth: data volume per unit time
• 5G cellular data: ≈ 5-20 Gbits/sec
• Home broadband: ≈ 300 Mbit/s
• Hard drives in a van: 50 TB/box ≈ 1 Gbit/s
(Very rough numbers, vary hugely in practice!)
Question: How long does it take to send a message of size S over a
communication link with bandwidth B and propagation delay T?
### Layered Protocols
![[layered-protocols.png]]Layers, interfaces, and protocols in the OSI model.
Question: How many layers does the TCP/IP protocol stack have?
#### Middleware Protocols
![[middleware-protocols.png]]
Middleware is invented to provide common services and protocols
that can be used by many different applications
• A rich set of communication protocols
• (Un)marshalling of data, necessary for integrated systems
• Naming protocols, to allow easy sharing of resources
• Security protocols for secure communication
• Scaling mechanisms, such as for replication and caching
#### Middleware adapted layering scheme
![[middleware-adapted-layering-scheme.png]]
##### Types of Communication (1)
![[communication-sync-ex.png]]
Distinguish between:
- Asynchronous versus synchronous communication
- Transient versus persistent communication
- Transient communication: Communication server discards message when it cannot be delivered at the next server, or at the receiver
- Persistent communication: a message is stored at a communication server as long as it takes to deliver it.
##### Types of Communication(2)
Some observations:
- Client/Server computing is generally based on a model of transient synchronous communication:
- Client and server have to be active at time of communication
- Client issues request and blocks until it receives reply
- Server essentially waits only for incoming requests, and subsequently processes them
Question: what are the drawbacks?
- Message-oriented middleware aims at high-level persistent asynchronous communication:
- Processes send each other messages, which are queued
- Sender needs not wait for immediate reply, but can do other things
- Middleware often ensures fault tolerance.
### Remote Procedure Call (RPC)
Communication between caller and callee can be hidden by using
procedure-call mechanism.
![[rpc-example.png]]
• Application developers are familiar with simple procedure model
• Well-engineered procedures operate in isolation (black box)
• There is no fundamental reason not to execute procedures on
separate machine

RPC Example
// Online shop handling customers card details
```java
Card card = new Card();
card.setCardNumber(“9876 54321 0987 1234");
card.setExpiryDate("10/2025");
card.setCVC("123");

Result result = paymentsService.processPayment(card, 3.99, Currency.GBP);
if (result.isSuccess()) {
	fulfilOrder();
} 
```
Implementation of this function is on another node!
#### RPC Operation
1. Client procedure calls client stub
2. Client stub builds message, calls local OS
3. Client's OS sends message to remote OS
4. Remote OS gives message to server stub
5. Server stub unpacks parameters, calls server!
![[rpc-operation-ex.png]]
6. Server does work, returns result to stub
7. Server builds message, calls local OS
8. Server's OS sends message to client OS
9. Client's OS gives message to client stub
10. Stub unpacks result, returns to client

RPC History
• SunRPC/ONC RPC (1980s, basis for NFS)
• CORBA: object-oriented middleware, hot in the 1990s
• Microsoft's DCOM and Java RMI (similar to CORBA)
• SOAP/XML-RPC: RPC using XML and HTTP (1998)
• Thrift (Facebook, 2007)
• gRPC (Google, 2015)
• REST (often with JSON)
• Ajax in web browsers
• Question: How does gRPC work?
#### RPC: Parameter Passing (1)
Packing parameters into a message is called parameter marshalling
Unpacking them is called unmarshalling.
There's more than just wrapping parameters into a message
• Client and server machines may have different data
representations (think of byte ordering)
• Wrapping a parameter means transforming a value into a
sequence of bytes
• a data structure or object state needs to be translated into a format that can
be stored (e.g. in a file or memory data buffer) or transmitted: serialisation
![[parameter-passing.png]]
#### RPC: Parameter Passing (2)
• Client and server have to agree on the same encoding
• How are basic data values represented (integers, floats, characters)
• How are complex data values represented (arrays, unions)
Conclusion:
• Client and server need to properly interpret messages, transforming them into machine-dependent representations.
#### Data Marshalling Issues
Client and server might encode characters differently:
– IBM mainframes use EBCDIC
– IBM-compatible PCs use ASCII codes
Client and server might implement integers and floating-point numbers differently:
– Intel-based machines are little-endian
– SPARC-based machines are big-endian
– RISC-V supports both
Client and server must agree on message format! e.g. 32 bits Data is 0x11223344

| BIG  | ENDIAN |
| ---- | ------ |
| Addr | Val    |
| 00   | 0x11   |
| 01   | 0x22   |
| 02   | 0x33   |
| 03   | 0x44   |

| LIL  | ENDIAN |
| ---- | ------ |
| Addr | Val    |
| 00   | 0x44   |
| 01   | 0x33   |
| 02   | 0x22   |
| 03   | 0x11   |
#### Asynchronous RPC
Get rid of the strict request-reply behaviour, but let the client continue without waiting for an answer from the server.

![[async-rpc-ex.png]]
#### Remote Method Invocation (RMI) Operation
![[rmi-ex.png]]
RMI supports object-oriented programming as opposed to procedural
programming (RPC)
• Common organisation of a remote object with client-side proxy
#### Message Oriented Communication: Transient Messaging with Sockets
![[transient-socket-messaging-ex.png]]
Connection-oriented communication pattern using sockets. Very low-level.
#### The Message-Passing Interface (MPI): Advanced Transient Messaging
![[advanced-transient-messaging-ex.png]]
Advent of high performance multicomputers
- Need for message-oriented primitives to easily write highly efficient applications
- Problem: most interconnection networks and high performance multicomputers were shipped with proprietary communication libraries
	- Need to be hardware independent 

MPI – Message Passing Interface
- Designed for parallel applications
- Assumes communication takes place within a known group of processes
- Makes use of underlying network.
### The Message-Passing Interface (MPI)
• Message passing primitives - Examples

| Primitive   | Meaning                                                    |
| ----------- | ---------------------------------------------------------- |
| `MPI_bsend` | Append outgoing messages to a local send buffer            |
| `MPI_send`  | Send message and wait until copied  to local/remote buffer |
| `MPI_recv`  | Receive message; block if there are none                   |
| `MPI_irecv` | Check for incoming messages, do not block                  |
#### Message-Queuing Model
Asynchronous persistent communication through
support of middleware-level queues. Queues
correspond to buffers at communication servers
![[mpi-message-queue-model.png]]
#### General Architecture of a Message-Queuing System
![[message-queuing-system-ex.png]]
The general organisation of a message-queuing system with routers.
#### AMQP: Advanced Message Queueing Protocol
- AMQP provides a platform-agnostic method for ensuring information is safely transported between applications, among organizations, within mobile infrastructures, and across the ClouD
- AMQP is used in various areas
- financial front office trading, transportation, smart grid, computer-generated animation, online gaming …
- Many operating systems include AMQP implementations
- There are Cloud-hosted offerings of AMQP, and it is embedded in virtualization infrastructure
- AMQP is an international standard http://www.amqp.org
- Examples of AMQP Support
	- RabbitMQ (see next slide)
	- ActiveMQ (see this week lab. session)
##### Example: Openstack Compute
Management Stack Control Built on Queues
Key Capabilities:
- Openstack: Cloud Virtual Infrastructure Manager http://www.openstack.org
- Message Queues: responsible for providing communications hub and managing data persistence
- RabbitMQ is default queue, MySQL DB
- Single “cell” (1 Queue, 1 Database) typically scales from 500 – 1000 physical machines https://www.rabbitmq.com
- Communications route through queue
	- API requests are validated and placed on queue
	- Workers listen to queues based on role
	- Responses are dispatched back through queue.
#### Summary
- We have discussed the rules that communication processes must adhere to
- Looked at a number of widely used models for communication
	- RPC
	- Sockets
	- Message Oriented Middleware
- Importance of message queueing systems.

Reading
- Chapter 4 - Communication. Tanenbaum A & van Steen M, Distributed Systems: Principles & Paradigms, 4th edition, 2024

Lab. Session
- MPI – Message Passing Interface
- JDBC – Java Database Connectivity